# 🎯 工作流速查卡

## 🔄 标准工作流程

### 日常开发 → 提交部署 → 继续开发

```bash
┌─────────────────────────────────────────────────┐
│ 1. 开发阶段 (本地环境)                         │
├─────────────────────────────────────────────────┤
│ $ make local                                    │
│ $ make status  # 确认是本地配置                │
│                                                 │
│ 开发、测试、调试...                             │
└─────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────┐
│ 2. 准备部署 (切换到生产配置)                   │
├─────────────────────────────────────────────────┤
│ $ make prod                                     │
│ $ make check-prod  # 检查配置                  │
└─────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────┐
│ 3. 提交代码                                     │
├─────────────────────────────────────────────────┤
│ $ git add .                                     │
│ $ git commit -m "feat: 描述"                    │
│   👆 自动检查配置                                │
└─────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────┐
│ 4. 推送部署                                     │
├─────────────────────────────────────────────────┤
│ $ git push origin main                          │
│   👆 Render自动部署                              │
└─────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────┐
│ 5. 切回本地环境                                 │
├─────────────────────────────────────────────────┤
│ $ make local                                    │
│                                                 │
│ 继续开发...                                     │
└─────────────────────────────────────────────────┘
```

## ⚡ 快捷命令

| 命令 | 说明 | 使用场景 |
|------|------|----------|
| `make local` | 切换到本地环境 | 开发前、部署后 |
| `make prod` | 切换到生产环境 | 部署前 |
| `make status` | 查看当前配置 | 任何时候 |
| `make check-prod` | 检查生产配置 | 部署前验证 |

## 📋 本次提交记录

```
Commit: a263bb9b1dfc19c1377992417a7b411b06b806ee
标题: 修复：题目的父题目ID可以为空

更改文件: 161个
新增代码: 44,260行

核心修复:
✓ backend/app/schemas/question.py - Pydantic验证器修复
✓ backend/app/crud.py - 更新为model_dump()
✓ frontend/src/views/question/Index.vue - 表单逻辑优化
✓ alembic/versions/e4f96b9601ef_*.py - 迁移分支合并

新增功能:
✓ 环境配置自动化工作流
✓ Git pre-commit hook
✓ 配置切换脚本
✓ Makefile快捷命令
```

## ✅ 已验证功能

- [x] 创建题目时parent_question_id可以为空
- [x] 配置自动切换（本地 ↔ 生产）
- [x] Git commit自动检查配置
- [x] 本地服务正常运行
- [x] API测试通过（已创建题目ID 123）

## 🔒 安全保障

✅ .env 文件已加入 .gitignore（敏感信息不会提交）
✅ 只提交配置模板（.env.local, .env.production）
✅ Pre-commit hook 自动检查配置
✅ 生产配置只在部署时使用

## 🎓 工作流要点

### ⭐ 核心原则
**开发用 local，部署用 production**

### 💡 最佳实践

1. **每次开发前**: `make local`
2. **每次部署前**: `make prod`
3. **部署之后**: `make local`
4. **有疑问时**: `make status`

### ⚠️ 注意事项

- 不要直接编辑 `.env` 文件（它会被覆盖）
- 修改配置请编辑 `.env.local` 或 `.env.production`
- 部署后记得切回本地环境
- Git commit 会自动提示配置状态

---

**当前环境**: 本地开发 ✓  
**可以继续开发**: 是 ✓  
**准备部署**: 运行 `make prod` ✓
