# LLM自动总结功能说明

## 概述

我们为调研平台集成了强大的LLM（大语言模型）自动总结功能，通过OpenRouter API调用先进的AI模型，为调研数据提供智能分析和自动报告生成。

## 功能特性

### 1. 智能问题生成
**API端点**: `POST /api/v1/llm/generate_questions`

**功能描述**: 根据给定主题自动生成专业的调研问题
- 支持多种问题类型（单选、多选、开放式）
- 根据主题智能调整问题内容
- 生成符合调研规范的问题

**示例请求**:
```json
{
  "topic": "员工满意度调研",
  "num_questions": 5
}
```

**示例响应**:
```json
{
  "questions": [
    "你对公司目前的工作环境和氛围满意吗？（单选：非常满意/满意/一般/不满意/非常不满意）",
    "你认为公司在哪些方面可以改进以提高员工满意度？（开放式问题）"
  ]
}
```

### 2. 智能回答总结
**API端点**: `POST /api/v1/llm/summarize_answers`

**功能描述**: 对调研问题的回答进行深度分析和总结
- 识别回答中的主要观点和趋势
- 进行情感分析和模式识别
- 提供专业的分析洞察

**示例请求**:
```json
{
  "question_text": "您对当前工作环境的满意度如何？",
  "answers": ["非常满意", "满意", "一般", "不满意", "非常不满意"]
}
```

**示例响应**:
```json
{
  "question_text": "您对当前工作环境的满意度如何？",
  "summary": "### 总结与分析\n\n1. **主要观点**：\n   - 用户的回答涵盖了工作环境满意度的全部五个选项...\n\n2. **趋势和模式**：\n   - 两极分化可能：若回答分布较均匀...\n\n3. **情感分析**：\n   - 中立偏混合：若"一般"和"满意"居多...\n\n4. **建议**：\n   - 需结合具体回答比例进一步验证趋势..."
}
```

### 3. 调研智能总结报告
**API端点**: `POST /api/v1/llm/generate_survey_summary`

**功能描述**: 生成完整的调研智能总结报告
- 综合分析所有问题和回答数据
- 生成专业的调研报告
- 提供关键发现和建议

**示例请求**:
```json
{
  "survey_data": {
    "survey_title": "员工满意度调研",
    "total_answers": 7,
    "question_analytics": [...],
    "participant_analysis": {...}
  }
}
```

**示例响应**:
```json
{
  "survey_title": "员工满意度调研",
  "total_answers": 7,
  "generated_at": "2025-08-19T10:00:00Z",
  "summary": "# 员工满意度调研总结报告\n\n## 1. 执行摘要\n本次员工满意度调研聚焦于员工对当前工作环境的满意度...\n\n## 2. 参与情况分析\n- **总参与者**：7人，样本量较小，可能代表性有限...\n\n## 3. 问题分析\n### 问题1：您对当前工作环境的满意度如何？\n- **回答分布**：\n  - 非常不满意：2人（28.6%）\n  - 不满意：2人（28.6%）...\n\n## 4. 关键发现\n1. **两极分化明显**：近60%的员工对工作环境持负面评价...\n2. **中间评价缺失**：仅1人选择"一般"...\n\n## 5. 建议和行动方案\n1. **立即行动**：\n   - 深入调查不满意的具体原因...\n2. **中期改进**：\n   - 建立定期满意度调研机制...\n\n## 6. 数据质量评估\n- **样本代表性**：当前样本主要集中在研发部门...\n- **数据可靠性**：回答分布合理，无明显异常...",
  "key_metrics": {
    "total_questions": 1,
    "total_participants": 7,
    "participation_rate": 0
  }
}
```

### 4. 问题深度洞察分析
**API端点**: `POST /api/v1/llm/generate_question_insights`

**功能描述**: 对单个问题进行深度洞察分析
- 分析回答模式和特点
- 识别关键发现和趋势
- 提供改进建议和行动方案

**示例请求**:
```json
{
  "question_data": {
    "question_id": 35,
    "question_text": "您对当前工作环境的满意度如何？",
    "question_type": "single_choice",
    "total_responses": 7,
    "response_distribution": {
      "不满意": 2,
      "一般": 1,
      "非常满意": 2,
      "非常不满意": 2
    },
    "options": ["非常满意", "满意", "一般", "不满意", "非常不满意"]
  }
}
```

**示例响应**:
```json
{
  "question_id": 35,
  "question_text": "您对当前工作环境的满意度如何？",
  "total_responses": 7,
  "insights": "## 回答模式分析\n\n### 分布特点\n- **两极分化严重**：满意和不满意各占28.6%...\n- **中间选项缺失**：仅14.3%选择"一般"...\n\n## 关键洞察\n\n### 1. 管理问题\n- 可能存在管理不善或资源配置不均的问题...\n\n### 2. 文化差异\n- 不同部门或团队可能存在文化差异...\n\n## 异常发现\n\n### 1. 分布异常\n- 满意度分布不符合正态分布...\n\n### 2. 极端值过多\n- 极端满意和极端不满意比例过高...\n\n## 改进建议\n\n### 1. 短期行动\n- 立即调查不满意员工的具体原因...\n\n### 2. 长期改进\n- 建立定期反馈机制...\n\n## 后续行动\n\n### 1. 深入调研\n- 进行一对一访谈了解具体情况...\n\n### 2. 制定改进计划\n- 基于调研结果制定具体的改进措施...",
  "response_distribution": {...},
  "analysis_timestamp": "2025-08-19T10:00:00Z"
}
```

### 5. 集成分析API
**API端点**: `GET /api/v1/organizations/{organization_id}/surveys/{survey_id}/analytics/ai-summary`

**功能描述**: 一键生成调研的AI智能总结报告
- 自动获取调研分析数据
- 调用LLM生成智能总结
- 返回完整的分析报告

**示例响应**:
```json
{
  "survey_title": "员工满意度调研",
  "total_answers": 7,
  "participation_rate": 53.8,
  "generated_at": "2025-08-19T10:00:00Z",
  "summary": "# 员工满意度调研总结报告\n\n## 1. 执行摘要\n本次员工满意度调研聚焦于员工对当前工作环境的满意度...",
  "key_metrics": {
    "total_questions": 6,
    "total_participants": 7,
    "participation_rate": 53.8
  }
}
```

### 6. 问题洞察API
**API端点**: `GET /api/v1/organizations/{organization_id}/surveys/{survey_id}/questions/{question_id}/ai-insights`

**功能描述**: 获取单个问题的AI深度洞察分析
- 自动获取问题分析数据
- 生成深度洞察报告
- 提供专业的分析建议

## 技术实现

### 1. LLM服务架构
- **API集成**: 使用OpenRouter API调用多种AI模型
- **模型选择**: 支持多种先进的AI模型（如DeepSeek、GPT等）
- **错误处理**: 完善的异常处理和重试机制
- **性能优化**: 超时控制和并发处理

### 2. 数据处理
- **数据预处理**: 自动处理不同格式的调研数据
- **Prompt工程**: 精心设计的提示词模板
- **结果后处理**: 智能解析和格式化AI输出
- **质量控制**: 数据验证和异常检测

### 3. 权限控制
- **组织隔离**: 确保用户只能访问自己组织的数据
- **API认证**: 基于JWT的身份验证
- **访问控制**: 细粒度的权限管理

## 使用场景

### 1. 调研设计阶段
- **快速生成问题**: 根据调研主题自动生成专业问题
- **问题优化**: 基于AI建议优化问题设计
- **模板生成**: 创建标准化的调研模板

### 2. 数据分析阶段
- **自动总结**: 快速生成调研结果总结
- **深度洞察**: 发现数据中的隐藏模式和趋势
- **异常检测**: 识别数据中的异常情况

### 3. 报告生成阶段
- **专业报告**: 自动生成标准化的调研报告
- **多维度分析**: 从不同角度分析调研结果
- **建议生成**: 基于数据提供改进建议

### 4. 决策支持阶段
- **趋势分析**: 识别长期趋势和变化
- **风险评估**: 评估潜在风险和问题
- **行动建议**: 提供具体的行动方案

## 性能特点

### 1. 响应速度
- **快速生成**: 问题生成通常在5-10秒内完成
- **智能总结**: 调研总结通常在20-30秒内完成
- **实时分析**: 支持实时数据分析和洞察

### 2. 准确性
- **专业分析**: 基于先进的AI模型提供专业分析
- **多维度**: 从多个角度分析数据
- **可解释性**: 提供清晰的分析逻辑和依据

### 3. 可扩展性
- **模型切换**: 支持切换不同的AI模型
- **功能扩展**: 易于添加新的分析功能
- **规模扩展**: 支持大规模数据处理

## 最佳实践

### 1. 数据准备
- 确保数据质量和完整性
- 提供足够的上下文信息
- 使用标准化的数据格式

### 2. 提示词优化
- 使用清晰、具体的提示词
- 包含必要的上下文信息
- 指定期望的输出格式

### 3. 结果验证
- 验证AI生成结果的准确性
- 结合人工判断进行确认
- 定期更新和优化模型

### 4. 性能监控
- 监控API调用成功率
- 跟踪响应时间和性能
- 及时处理异常情况

## 总结

LLM自动总结功能为调研平台提供了强大的AI分析能力，能够：

1. **提升效率**: 自动化调研分析和报告生成
2. **增强洞察**: 发现数据中的隐藏模式和趋势
3. **保证质量**: 提供专业、准确的分析结果
4. **支持决策**: 为管理决策提供数据驱动的建议

通过集成先进的AI技术，我们为用户提供了从调研设计到结果分析的完整智能化解决方案，大大提升了调研工作的效率和质量。
