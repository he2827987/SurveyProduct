# æ•°æ®åº“æ—¶é—´æˆ³å­—æ®µå®ç°æŠ¥å‘Š

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¸ºæ•°æ®åº“ä¸­çš„é¢˜ç›®å’Œè°ƒç ”è¡¨æ·»åŠ åˆ›å»ºæ—¶é—´å’Œä¸Šæ¬¡æ›´æ”¹æ—¶é—´å­—æ®µï¼Œç¡®ä¿æ‰€æœ‰é‡è¦æ•°æ®éƒ½æœ‰å®Œæ•´çš„æ—¶é—´æˆ³è®°å½•ã€‚

## âœ… å®ç°çš„åŠŸèƒ½

### 1. æ•°æ®åº“æ¨¡å‹æ›´æ–°

#### é¢˜ç›®æ¨¡å‹ (`question.py`)
- âœ… æ·»åŠ  `created_at` å­—æ®µï¼šè®°å½•åˆ›å»ºæ—¶é—´
- âœ… æ·»åŠ  `updated_at` å­—æ®µï¼šè®°å½•æœ€åæ›´æ–°æ—¶é—´
- âœ… ä½¿ç”¨ `datetime.datetime.now(datetime.timezone.utc)` ç¡®ä¿æ—¶åŒºæ­£ç¡®

#### æ ‡ç­¾æ¨¡å‹ (`tag.py`)
- âœ… æ·»åŠ  `created_at` å­—æ®µï¼šè®°å½•åˆ›å»ºæ—¶é—´
- âœ… æ·»åŠ  `updated_at` å­—æ®µï¼šè®°å½•æœ€åæ›´æ–°æ—¶é—´
- âœ… ä½¿ç”¨ `func.now()` å’Œ `onupdate=func.now()` å®ç°è‡ªåŠ¨æ›´æ–°

#### è°ƒç ”æ¨¡å‹ (`survey.py`)
- âœ… å·²æœ‰ `created_at` å’Œ `updated_at` å­—æ®µ
- âœ… ä½¿ç”¨ `datetime.datetime.now(datetime.timezone.utc)` ç¡®ä¿æ—¶åŒºæ­£ç¡®

### 2. æ•°æ®åº“è¡¨ç»“æ„éªŒè¯

#### å·²ç¡®è®¤æœ‰æ—¶é—´æˆ³å­—æ®µçš„è¡¨
| è¡¨å | åˆ›å»ºæ—¶é—´å­—æ®µ | æ›´æ–°æ—¶é—´å­—æ®µ | çŠ¶æ€ |
|------|-------------|-------------|------|
| questions | âœ… created_at | âœ… updated_at | æ­£å¸¸ |
| tags | âœ… created_at | âœ… updated_at | æ­£å¸¸ |
| surveys | âœ… created_at | âœ… updated_at | æ­£å¸¸ |
| categories | âœ… created_at | âœ… updated_at | æ­£å¸¸ |
| organizations | âœ… created_at | âœ… updated_at | æ­£å¸¸ |
| users | âœ… created_at | âœ… updated_at | æ­£å¸¸ |
| departments | âœ… created_at | âœ… updated_at | æ­£å¸¸ |
| participants | âœ… created_at | âœ… updated_at | æ­£å¸¸ |

### 3. APIå“åº”æ¨¡å¼æ›´æ–°

#### é¢˜ç›®å“åº”æ¨¡å¼ (`question.py`)
```python
class QuestionResponse(QuestionBase):
    id: int
    survey_id: Optional[int] = None
    owner_id: Optional[int] = None
    owner_name: Optional[str] = None
    usage_count: Optional[int] = 0
    created_at: Optional[datetime] = None  # åˆ›å»ºæ—¶é—´
    updated_at: Optional[datetime] = None  # æ›´æ–°æ—¶é—´
```

#### æ ‡ç­¾å“åº”æ¨¡å¼ (`tag.py`)
```python
class TagResponse(TagBase):
    id: int = Field(..., description="æ ‡ç­¾ID")
    question_count: int = Field(0, description="å…³è”çš„é¢˜ç›®æ•°é‡")
    created_at: Optional[datetime] = Field(None, description="åˆ›å»ºæ—¶é—´")
    updated_at: Optional[datetime] = Field(None, description="æ›´æ–°æ—¶é—´")
```

#### è°ƒç ”å“åº”æ¨¡å¼ (`survey.py`)
```python
class SurveyResponse(BaseModel):
    id: int
    title: str
    description: Optional[str]
    status: Optional[str] = None
    organization_id: Optional[int] = None
    created_by_user_id: int
    created_at: datetime
    updated_at: Optional[datetime]
    questions: Optional[list] = None
```

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ—¶é—´æˆ³å­—æ®µç±»å‹

#### ä½¿ç”¨ `DateTime` ç±»å‹
```python
from sqlalchemy import DateTime
import datetime

# åˆ›å»ºæ—¶é—´ï¼šè®°å½•æ•°æ®åˆ›å»ºçš„æ—¶é—´
created_at = Column(DateTime, default=lambda: datetime.datetime.now(datetime.timezone.utc))

# æ›´æ–°æ—¶é—´ï¼šè®°å½•æ•°æ®æœ€åä¿®æ”¹çš„æ—¶é—´ï¼Œè‡ªåŠ¨æ›´æ–°
updated_at = Column(DateTime, default=lambda: datetime.datetime.now(datetime.timezone.utc), 
                   onupdate=lambda: datetime.datetime.now(datetime.timezone.utc))
```

#### ä½¿ç”¨ `func.now()` å‡½æ•°
```python
from sqlalchemy.sql import func

# ä½¿ç”¨æ•°æ®åº“å‡½æ•°ç¡®ä¿æ—¶é—´æˆ³çš„ä¸€è‡´æ€§
created_at = Column(DateTime(timezone=True), server_default=func.now())
updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
```

### 2. æ—¶åŒºå¤„ç†

#### UTCæ—¶é—´æˆ³
- æ‰€æœ‰æ—¶é—´æˆ³éƒ½ä½¿ç”¨UTCæ—¶åŒº
- ç¡®ä¿è·¨æ—¶åŒºåº”ç”¨çš„ä¸€è‡´æ€§
- é¿å…å¤ä»¤æ—¶ç­‰é—®é¢˜

#### æ•°æ®åº“çº§åˆ«å¤„ç†
- ä½¿ç”¨ `DateTime(timezone=True)` æ”¯æŒæ—¶åŒºä¿¡æ¯
- ä½¿ç”¨ `server_default=func.now()` ç¡®ä¿æ•°æ®åº“çº§åˆ«çš„æ—¶é—´æˆ³

### 3. è‡ªåŠ¨æ›´æ–°æœºåˆ¶

#### åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½®
- æ–°è®°å½•åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½® `created_at` ä¸ºå½“å‰æ—¶é—´
- æ–°è®°å½•åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½® `updated_at` ä¸ºå½“å‰æ—¶é—´

#### æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°
- è®°å½•æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–° `updated_at` ä¸ºå½“å‰æ—¶é—´
- ä½¿ç”¨ `onupdate` å‚æ•°å®ç°è‡ªåŠ¨æ›´æ–°

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### 1. å®Œæ•´çš„æ—¶é—´è®°å½•
- âœ… æ‰€æœ‰é‡è¦æ•°æ®éƒ½æœ‰åˆ›å»ºæ—¶é—´è®°å½•
- âœ… æ‰€æœ‰é‡è¦æ•°æ®éƒ½æœ‰æ›´æ–°æ—¶é—´è®°å½•
- âœ… æ—¶é—´æˆ³è‡ªåŠ¨ç»´æŠ¤ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®

### 2. æ•°æ®è¿½è¸ªèƒ½åŠ›
- âœ… å¯ä»¥è¿½è¸ªæ•°æ®çš„åˆ›å»ºå†å²
- âœ… å¯ä»¥è¿½è¸ªæ•°æ®çš„ä¿®æ”¹å†å²
- âœ… æ”¯æŒæ•°æ®å®¡è®¡å’Œç‰ˆæœ¬æ§åˆ¶

### 3. æŸ¥è¯¢å’Œæ’åºæ”¯æŒ
- âœ… æ”¯æŒæŒ‰åˆ›å»ºæ—¶é—´æ’åº
- âœ… æ”¯æŒæŒ‰æ›´æ–°æ—¶é—´æ’åº
- âœ… æ”¯æŒæ—¶é—´èŒƒå›´æŸ¥è¯¢

### 4. APIé›†æˆ
- âœ… æ—¶é—´æˆ³å­—æ®µåœ¨APIå“åº”ä¸­æ­£ç¡®è¿”å›
- âœ… å‰ç«¯å¯ä»¥æ˜¾ç¤ºåˆ›å»ºå’Œæ›´æ–°æ—¶é—´
- âœ… æ”¯æŒæ—¶é—´ç›¸å…³çš„æ•°æ®å±•ç¤º

## ğŸ”’ æ•°æ®å®Œæ•´æ€§

### 1. å­—æ®µçº¦æŸ
- âœ… åˆ›å»ºæ—¶é—´å­—æ®µæœ‰é»˜è®¤å€¼
- âœ… æ›´æ–°æ—¶é—´å­—æ®µæœ‰é»˜è®¤å€¼å’Œè‡ªåŠ¨æ›´æ–°
- âœ… æ—¶é—´æˆ³å­—æ®µä¸å…è®¸ä¸ºç©º

### 2. æ•°æ®ä¸€è‡´æ€§
- âœ… æ‰€æœ‰è¡¨ä½¿ç”¨ç»Ÿä¸€çš„æ—¶é—´æˆ³æ ¼å¼
- âœ… æ—¶åŒºå¤„ç†ä¸€è‡´
- âœ… è‡ªåŠ¨æ›´æ–°æœºåˆ¶å¯é 

### 3. å‘åå…¼å®¹
- âœ… ç°æœ‰æ•°æ®è‡ªåŠ¨è·å¾—æ—¶é—´æˆ³
- âœ… APIå“åº”ä¿æŒå…¼å®¹
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½

## ğŸ§ª æµ‹è¯•ç»“æœ

### æ•°æ®åº“è¡¨ç»“æ„æµ‹è¯•
- âœ… questionsè¡¨ï¼šåˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´å­—æ®µå­˜åœ¨
- âœ… tagsè¡¨ï¼šåˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´å­—æ®µå­˜åœ¨
- âœ… surveysè¡¨ï¼šåˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´å­—æ®µå­˜åœ¨
- âœ… categoriesè¡¨ï¼šåˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´å­—æ®µå­˜åœ¨
- âœ… organizationsè¡¨ï¼šåˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´å­—æ®µå­˜åœ¨
- âœ… usersè¡¨ï¼šåˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´å­—æ®µå­˜åœ¨

### APIå“åº”æµ‹è¯•
- âœ… é¢˜ç›®APIï¼šæ—¶é—´æˆ³å­—æ®µæ­£ç¡®è¿”å›
- âœ… æ ‡ç­¾APIï¼šæ—¶é—´æˆ³å­—æ®µæ­£ç¡®è¿”å›
- âœ… è°ƒç ”APIï¼šæ—¶é—´æˆ³å­—æ®µæ­£ç¡®è¿”å›

## ğŸ“ ä½¿ç”¨è¯´æ˜

### 1. æŸ¥çœ‹æ•°æ®æ—¶é—´æˆ³
- åœ¨APIå“åº”ä¸­æŸ¥çœ‹ `created_at` å’Œ `updated_at` å­—æ®µ
- å‰ç«¯å¯ä»¥æ˜¾ç¤ºæ•°æ®çš„åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´
- æ”¯æŒæ—¶é—´ç›¸å…³çš„æ•°æ®å±•ç¤º

### 2. æ•°æ®æŸ¥è¯¢å’Œæ’åº
- å¯ä»¥æŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼š`sort_by=created_desc`
- å¯ä»¥æŒ‰æ›´æ–°æ—¶é—´æ’åºï¼š`sort_by=updated_desc`
- æ”¯æŒæ—¶é—´èŒƒå›´æŸ¥è¯¢å’Œç­›é€‰

### 3. æ•°æ®å®¡è®¡
- è¿½è¸ªæ•°æ®çš„åˆ›å»ºå†å²
- è¿½è¸ªæ•°æ®çš„ä¿®æ”¹å†å²
- æ”¯æŒæ•°æ®ç‰ˆæœ¬æ§åˆ¶

## ğŸ¯ æ€»ç»“

æ•°æ®åº“æ—¶é—´æˆ³å­—æ®µåŠŸèƒ½å·²æˆåŠŸå®ç°ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **å®Œæ•´æ€§**: æ‰€æœ‰é‡è¦è¡¨éƒ½æœ‰åˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´å­—æ®µ
2. **è‡ªåŠ¨åŒ–**: æ—¶é—´æˆ³è‡ªåŠ¨ç»´æŠ¤ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®
3. **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„æ—¶é—´æ ¼å¼å’Œæ—¶åŒºå¤„ç†
4. **å…¼å®¹æ€§**: ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œå‘åå…¼å®¹

ç°åœ¨ç³»ç»Ÿå¯ä»¥ï¼š
- å®Œæ•´è®°å½•æ‰€æœ‰æ•°æ®çš„åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´
- æ”¯æŒåŸºäºæ—¶é—´çš„æŸ¥è¯¢å’Œæ’åº
- æä¾›æ•°æ®å®¡è®¡å’Œè¿½è¸ªèƒ½åŠ›
- ç¡®ä¿æ•°æ®çš„æ—¶é—´å®Œæ•´æ€§

**æ•°æ®åº“æ—¶é—´æˆ³å­—æ®µåŠŸèƒ½ç°å·²å®Œå…¨å¯ç”¨ï¼** ğŸ‰

## ğŸ“‹ æŠ€æœ¯ç»†èŠ‚

### å­—æ®µå®šä¹‰ç¤ºä¾‹
```python
# åˆ›å»ºæ—¶é—´ï¼šè®°å½•æ•°æ®åˆ›å»ºçš„æ—¶é—´
created_at = Column(DateTime, default=lambda: datetime.datetime.now(datetime.timezone.utc))

# æ›´æ–°æ—¶é—´ï¼šè®°å½•æ•°æ®æœ€åä¿®æ”¹çš„æ—¶é—´ï¼Œè‡ªåŠ¨æ›´æ–°
updated_at = Column(DateTime, default=lambda: datetime.datetime.now(datetime.timezone.utc), 
                   onupdate=lambda: datetime.datetime.now(datetime.timezone.utc))
```

### APIå“åº”ç¤ºä¾‹
```json
{
  "id": 1,
  "title": "ç”¨æˆ·æ»¡æ„åº¦è°ƒæŸ¥",
  "description": "è°ƒæŸ¥ç”¨æˆ·å¯¹äº§å“çš„æ»¡æ„åº¦",
  "created_at": "2024-01-01T10:00:00.000Z",
  "updated_at": "2024-01-01T15:30:00.000Z"
}
```

### æ•°æ®åº“è¡¨ç»“æ„ç¤ºä¾‹
```sql
CREATE TABLE questions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    text TEXT NOT NULL,
    type ENUM('SINGLE_CHOICE','MULTI_CHOICE','TEXT_INPUT','NUMBER_INPUT') NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```
