# 调研平台数据分析功能说明

## 概述

我们为多组织调研平台开发了完整的数据分析功能，支持从基础统计到高级分析的全面数据洞察。

## 功能特性

### 1. 调研概览分析
**API端点**: `GET /api/v1/organizations/{organization_id}/analytics/overview`

**功能描述**: 提供组织的整体调研统计概览
- 总调研数量
- 总答案数量
- 总参与者数量
- 平均答案数
- 最近7天的参与趋势

**示例响应**:
```json
{
  "total_surveys": 1,
  "total_answers": 7,
  "total_participants": 7,
  "average_answers_per_survey": 7.0,
  "daily_trend": {
    "2025-08-19": 2,
    "2025-08-18": 0,
    "2025-08-17": 0,
    "2025-08-16": 0,
    "2025-08-15": 1,
    "2025-08-14": 0,
    "2025-08-13": 0
  }
}
```

### 2. 调研详细分析
**API端点**: `GET /api/v1/organizations/{organization_id}/surveys/{survey_id}/analytics`

**功能描述**: 提供特定调研的详细分析
- 每个问题的回答分布
- 参与者分析（按部门、职位）
- 支持多种问题类型（单选、多选、文本、数字）

**示例响应**:
```json
{
  "survey_id": 1,
  "survey_title": "员工满意度调研",
  "total_answers": 7,
  "question_analytics": [
    {
      "question_id": 35,
      "question_text": "您对当前工作环境的满意度如何？",
      "question_type": "single_choice",
      "total_responses": 7,
      "response_distribution": {
        "不满意": 2,
        "一般": 1,
        "非常满意": 2,
        "非常不满意": 2
      },
      "options": ["非常满意", "满意", "一般", "不满意", "非常不满意"]
    }
  ],
  "participant_analysis": {
    "by_department": {
      "研发部": 5,
      "测试部门": 2
    },
    "by_position": {
      "软件工程师": 1,
      "产品经理": 1,
      "UI设计师": 1
    },
    "total_participants": 7
  }
}
```

### 3. 参与者分析
**API端点**: `GET /api/v1/organizations/{organization_id}/analytics/participants`

**功能描述**: 分析组织内的参与者情况
- 总参与者数量
- 活跃参与者数量
- 参与率统计
- 按部门分组统计
- 按职位分组统计

**示例响应**:
```json
{
  "total_participants": 13,
  "active_participants": 7,
  "participation_rate": 53.85,
  "by_department": {
    "研发部": {
      "count": 5,
      "participants": [
        {"id": 7, "name": "张三", "position": "软件工程师"}
      ]
    }
  },
  "by_position": {
    "软件工程师": 1,
    "产品经理": 1,
    "UI设计师": 1
  }
}
```

### 4. 趋势分析
**API端点**: `GET /api/v1/organizations/{organization_id}/analytics/trends?days=30`

**功能描述**: 分析参与趋势的时间变化
- 可自定义分析天数（默认30天）
- 每日答案数量
- 每日独立参与者数量
- 每日活跃调研数量

**示例响应**:
```json
{
  "period_days": 30,
  "total_answers": 7,
  "trend_data": [
    {
      "date": "2025-07-28",
      "answers": 1,
      "unique_participants": 1,
      "active_surveys": 1
    }
  ]
}
```

### 5. 交叉分析
**API端点**: `GET /api/v1/organizations/{organization_id}/analytics/cross-analysis?survey_id=1&question1_id=35&question2_id=36`

**功能描述**: 分析两个问题之间的关系
- 支持不同问题类型之间的交叉分析
- 自动处理单选、多选等不同回答格式
- 提供详细的交叉统计结果

**示例响应**:
```json
{
  "survey_id": 1,
  "question1": {
    "id": 35,
    "text": "您对当前工作环境的满意度如何？",
    "type": "single_choice"
  },
  "question2": {
    "id": 36,
    "text": "您认为公司的薪资待遇如何？",
    "type": "single_choice"
  },
  "cross_analysis": {
    "不满意": {
      "很有竞争力": 1,
      "偏低": 1
    },
    "非常满意": {
      "很低": 2
    }
  }
}
```

### 6. 数据导出
**API端点**: `GET /api/v1/organizations/{organization_id}/analytics/export?survey_id=1`

**功能描述**: 导出分析数据
- 支持导出特定调研的详细数据
- 支持导出组织概览数据
- 提供结构化的JSON格式数据

**示例响应**:
```json
{
  "survey_id": 1,
  "survey_title": "员工满意度调研",
  "total_records": 7,
  "data": [
    {
      "answer_id": 1,
      "participant_id": 7,
      "submitted_at": "2025-08-12T16:12:36",
      "q35_您对当前工作环境的满意度如何？": "不满意",
      "q36_您认为公司的薪资待遇如何？": "很有竞争力"
    }
  ]
}
```

## 技术实现

### 数据库设计
- 使用SQLAlchemy ORM进行数据查询
- 支持复杂的关联查询和聚合统计
- 优化查询性能，减少数据库访问次数

### 权限控制
- 基于组织的访问权限控制
- 确保用户只能访问自己组织的数据
- 支持多组织数据隔离

### 数据处理
- 自动处理不同问题类型的回答格式
- 支持JSON格式的复杂数据结构
- 提供数据验证和错误处理

## 使用场景

### 1. 调研效果评估
- 通过概览分析了解整体参与情况
- 通过趋势分析观察参与热度变化
- 通过参与者分析了解目标群体覆盖情况

### 2. 问题设计优化
- 通过详细分析了解每个问题的回答分布
- 通过交叉分析发现问题间的关联关系
- 识别需要改进的问题设计

### 3. 组织管理决策
- 通过参与者分析了解各部门参与情况
- 通过趋势分析制定推广策略
- 通过数据导出进行进一步的数据挖掘

### 4. 报告生成
- 自动生成标准化的分析报告
- 支持数据导出进行自定义分析
- 提供可视化的数据展示

## 扩展功能

### 1. 可视化图表
- 支持生成饼图、柱状图、折线图等
- 提供交互式的数据探索界面
- 支持自定义图表样式

### 2. 高级统计
- 支持相关性分析
- 提供统计显著性检验
- 支持多维度数据分析

### 3. 实时监控
- 提供实时参与数据更新
- 支持数据变化告警
- 提供自动化的报告生成

## 总结

数据分析功能为调研平台提供了强大的数据洞察能力，支持从基础统计到高级分析的全面需求。通过合理的API设计和数据处理，为用户提供了直观、准确、有用的分析结果，帮助用户更好地理解调研数据并做出明智的决策。
